<%= render "layouts/header" %>

<div class="content">
    <p id="notice"><%= notice %></p>
    <div class="marginleft20">
        <div class="inline">
          <small>
            <% if !current_user.nil? %>
              <% if @likes.find_by_contribution_id(@contribution.id).blank?%>
                <%= link_to '▲','/like/'+ @contribution.id.to_s, method: :put%>
              <%else %> 
                <%= link_to '▼','/dislike/'+ @contribution.id.to_s, method: :put%>
              <%end%>
            <%else%>
              <%= link_to '▲',user_google_oauth2_omniauth_authorize_path %>
            <%end%>
          </small>
          <a href="<%= @contribution.url %>"><%= @contribution.title %>
            <small>(<%= @contribution.url %>)</small>
          </a>
        </div>
        <div>
          <small>
            <%=@contribution.points%> points by <%=@contribution.creator%> 
            <%= render 'timer', contribution: @contribution %> 
            |
            <%= link_to 'comments', @contribution%>
            <% if !current_user.nil? && @contribution.checkIfMine(current_user.email) %>
               |
               <%= link_to 'edit', edit_contribution_path(@contribution)%></td> 
               |
               <%= link_to 'delete', @contribution, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            <% end %>
          </small>
        </div>
        <%= @contribution.text %>
        <div>
          <%= render "comments/form" %>
        </div>
        <br>
        <p>
          <strong>Comment:</strong>
        </p>
        
        <div style="margin-top: 10px;">
          <% @coments.each do |comment| %>
             <div> 
               <small> <%= link_to '▲' %>
                 <a><%= comment.creator %></a>
                 <%= render 'comments/timer', comment: comment %> 
               </small>
             </div>
            <div class="pad-comment">
              <%= comment.content%>
              
            </div>
            <div><small>
              <div class="pad-comment">
                <%= link_to 'Reply', new_reply_path(:comment_id => comment.id, :contribution_id => @contribution.id) %></small>
              </div>
              <div>
                 <% comment.replies.each do |rep| %>
                   <div class="reply">
                     <%= rep.content %>
                     <%= link_to 'Reply', rep %>
                     <div>
                       <% rep.replies.each do |repChild| %>
                         <div class="reply">
                           <%= repChild.content %>
                           <%= link_to 'Reply', repChild %>
                         </div>
                       <% end %>
                     </div>
                   </div>
                 <% end %>
              </div>
            </div>
            <br>
        <% end %>
      </div>
    </div>
</div>